<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/webflow
        				http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
	start-state="menu" parent="max-int">

   <action-state id="menu">
		<on-entry>
			<evaluate expression="input" result="flowScope.menuInput" />

			<evaluate expression="grammar" result="flowScope.grammar" />
			<set name="flowScope.grammar.type" value="'builtin'"/>
			<set name="flowScope.grammar.src" value="'dtmf/digits?length=1'"/>
			<evaluate expression="flowScope.menuInput.grammars.add(flowScope.grammar)"/>

			<evaluate expression="audioItem" result="flowScope.mainMenutPT1AudioItem" />
			<set name="flowScope.mainMenutPT1AudioItem.wording" value="locutionProvider.getLocution(T(com.vectorsf.jvoiceframework.testapp.locution.Menu).MAIN_MENU_PT1)"/> 
			<evaluate expression="flowScope.menuInput.mainAudios.add(flowScope.mainMenutPT1AudioItem)"/>
			
			<evaluate expression="audioItem" result="flowScope.mainMenutPT2AudioItem" />
			<set name="flowScope.mainMenutPT2AudioItem.wording" value="locutionProvider.getLocution(T(com.vectorsf.jvoiceframework.testapp.locution.Menu).MAIN_MENU_PT2)"/> 
			<evaluate expression="flowScope.menuInput.mainAudios.add(flowScope.mainMenutPT2AudioItem)"/>
			
			<evaluate expression="audioItem" result="flowScope.mainMenutPT3AudioItem" />
			<set name="flowScope.mainMenutPT3AudioItem.wording" value="locutionProvider.getLocution(T(com.vectorsf.jvoiceframework.testapp.locution.Menu).MAIN_MENU_PT3)"/> 
			<evaluate expression="flowScope.menuInput.mainAudios.add(flowScope.mainMenutPT3AudioItem)"/>

			<evaluate expression="audioItem" result="flowScope.mainMenuNMAudioItem" />
			<set name="flowScope.mainMenuNMAudioItem.wording" value="locutionProvider.getLocution(T(com.vectorsf.jvoiceframework.testapp.locution.Menu).MAIN_MENU_NM)"/> 
			<evaluate expression="flowScope.menuInput.noMatchAudios.add(flowScope.mainMenuNMAudioItem)"/>

			<evaluate expression="audioItem" result="flowScope.mainMenuNIAudioItem" />
			<set name="flowScope.mainMenuNIAudioItem.wording" value="locutionProvider.getLocution(T(com.vectorsf.jvoiceframework.testapp.locution.Menu).MAIN_MENU_NI)"/> 
			<evaluate expression="flowScope.menuInput.noInputAudios.add(flowScope.mainMenuNIAudioItem)"/>	
		</on-entry>

		<evaluate expression="flowProcessor.process(flowScope.menuInput)" />

		<transition to="render"></transition>
	</action-state>

	<!-- los eventos maxnomatch y maxnoinput los tratamos en el superflujo max-int -->
	<view-state id="render" view="render">
		<on-entry>
			<evaluate expression="lastInputResult" result="flowScope.lastInputResult"/>
		</on-entry>
		<transition on="match" to="end">
			<set name="flowScope.lastInputResult.interpretation" value="requestParameters.interpretation"/>			
		</transition>
	</view-state>

	 <end-state id="end" >
		<output name="menuOption" value="flowScope.lastInputResult.interpretation" />
	</end-state>
</flow>